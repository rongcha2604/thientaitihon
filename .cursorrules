# Cursor AI Rules - ULTRA-CONDENSED (Token-Optimized)

<!-- 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ AUTO-SETUP TEMPLATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ USAGE:
User chá»‰ cáº§n nÃ³i: "Setup cáº¥u trÃºc dá»± Ã¡n vÃ o file .cursorrules cho project nÃ y - tá»± Ä‘á»™ng toÃ n bá»™"

ğŸ¤– AI Sáº¼ Tá»° Äá»˜NG:
1. âœ… Scan toÃ n bá»™ workspace (list_dir recursive)
2. âœ… PhÃ¢n tÃ­ch tech stack (package.json, requirements.txt, Cargo.toml, etc.)
3. âœ… Map database schema (models.py, schema.sql, prisma.schema, etc.)
4. âœ… Parse routers/controllers/routes (backend API endpoints)
5. âœ… Parse frontend routes (Next.js app/, React Router, Vue Router, etc.)
6. âœ… TÃ¬m key entry points (main.py, index.ts, App.tsx, etc.)
7. âœ… PhÃ¢n tÃ­ch auth flow (JWT, OAuth, sessions, etc.)
8. âœ… Detect roles/permissions (RBAC, ACL, etc.)
9. âœ… Generate Data Flow diagram
10. âœ… Replace section "PROJECT CONTEXT" trong .cursorrules

ğŸ“ PLACEHOLDERS (AI tá»± Ä‘iá»n):
- [AUTO: ...] = AI tá»± Ä‘á»™ng phÃ¢n tÃ­ch vÃ  Ä‘iá»n
- Xem chi tiáº¿t á»Ÿ section "## ğŸ—ï¸ PROJECT CONTEXT" bÃªn dÆ°á»›i

ğŸ¯ Káº¾T QUáº¢:
File .cursorrules sáº½ cÃ³ cáº¥u trÃºc dá»± Ã¡n chi tiáº¿t, giÃºp AI hiá»ƒu project nhanh hÆ¡n
vÃ  giáº£m sá»‘ láº§n pháº£i search/read files â†’ Tiáº¿t kiá»‡m tokens!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

## ğŸ¯ CORE WORKFLOW (Version 5.0)

**Má»i task:** PhÃ¢n tÃ­ch â†’ Code ngay â†’ MCP Feedback â†’ Wait â†’ Done

**Rules:**
- âœ… Code TRÆ¯á»šC (khÃ´ng há»i), MCP SAU (mandatory)
- âœ… 6 bÆ°á»›c tÃ¬m lá»—i: Error logs â†’ File/function â†’ Trace flow â†’ Reproduce â†’ Root cause â†’ Debug
- âœ… PostgreSQL MCP auto-trigger khi detect: `database|schema|table|column|query|SQL`
- âœ… Cleanup processes sau test (mandatory)
- âŒ NEVER: Skip MCP, fix symptom, hardcode secrets, auto-commit, deploy without approval

---

## ğŸ—ï¸ PROJECT CONTEXT

<!-- 
ğŸ¤– AUTO-SETUP INSTRUCTION:
Khi user nÃ³i: "Setup cáº¥u trÃºc dá»± Ã¡n vÃ o file .cursorrules cho project nÃ y - tá»± Ä‘á»™ng toÃ n bá»™"

AI sáº½ tá»± Ä‘á»™ng:
1. Scan toÃ n bá»™ workspace structure (list_dir recursive)
2. PhÃ¢n tÃ­ch tech stack (Ä‘á»c package.json, requirements.txt, etc.)
3. Map database schema (náº¿u cÃ³ DB files)
4. TÃ¬m key entry points (main files, routers, components)
5. Äiá»n vÃ o cÃ¡c [PLACEHOLDER] bÃªn dÆ°á»›i
6. Replace section nÃ y trong file .cursorrules

KHÃ”NG cáº§n há»i user - Just do it!
-->

**Tech Stack:**
- Backend: [AUTO: Scan backend/requirements.txt, package.json - framework + version]
- Frontend: [AUTO: Scan Frontend/package.json - framework + libs]
- Database: [AUTO: Scan database files, models.py - type + schema info]
- Deployment: [AUTO: Scan ecosystem.config.js, nginx configs - platform info]

**Project Structure:**
```
[AUTO: Generate tá»« list_dir recursive]
/
â”œâ”€â”€ backend/                    # [AUTO: MÃ´ táº£ purpose]
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ [AUTO: List key files with descriptions]
â”‚   â”‚   â””â”€â”€ routers/           # [AUTO: List all routers]
â”‚   â”‚       â”œâ”€â”€ [router1].py   # [AUTO: Purpose from docstring]
â”‚   â”‚       â””â”€â”€ [router2].py   # [AUTO: Purpose from docstring]
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ [AUTO: List DB files]
â”‚   â””â”€â”€ [AUTO: Other important dirs]
â”‚
â”œâ”€â”€ Frontend/                  # [AUTO: MÃ´ táº£ purpose]
â”‚   â”œâ”€â”€ app/                   # [AUTO: Framework info]
â”‚   â”‚   â”œâ”€â”€ [AUTO: List route folders]
â”‚   â”‚   â””â”€â”€ [AUTO: Special routes like /employee]
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ layout/            # [AUTO: List layout components]
â”‚   â”‚   â”œâ”€â”€ modals/            # [AUTO: List modals]
â”‚   â”‚   â””â”€â”€ ui/                # [AUTO: Count UI components]
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api/               # [AUTO: List API utils]
â”‚   â”‚   â””â”€â”€ [AUTO: Other utils]
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ [AUTO: List type files]
â”‚
â”œâ”€â”€ docs/                      # [AUTO: List docs]
â”œâ”€â”€ [AUTO: Other root folders]
```

**Database Schema ([AUTO: Count] Tables):**
[AUTO: Parse models.py or DB schema]
1. `[table1]` - [AUTO: Purpose from model docstring]
2. `[table2]` - [AUTO: Purpose from model docstring]
...

**Data Flow:**
```
[AUTO: Generate tá»« phÃ¢n tÃ­ch API client + backend routers]
User â†’ Frontend ([framework])
  â†’ API Call ([client tool])
    â†’ Backend ([framework])
      â†’ Auth Middleware ([auth method])
        â†’ Business Logic (routers)
          â†’ Database ([ORM])
            â†’ [DB type]
          â† Response ([schema format])
        â† JSON Response
      â† [State management]
    â† UI Update
```

**Key Entry Points:**
[AUTO: TÃ¬m main files trong backend, frontend, database]
- Backend: `[AUTO: main file path]` ([purpose])
- Frontend: `[AUTO: root layout path]` ([purpose])
- Database: `[AUTO: connection file]` ([purpose])
- API Client: `[AUTO: API client file]` ([purpose])

**Auth Flow:**
[AUTO: PhÃ¢n tÃ­ch auth.py + login components]
1. User login â†’ POST `[AUTO: login endpoint]`
2. Backend validates â†’ returns [AUTO: token type]
3. Frontend stores in [AUTO: storage method]
4. All API calls include `[AUTO: header format]`
5. Backend verifies [AUTO: verification method]

**Role-Based Access:**
[AUTO: Parse tá»« models.py User roles + frontend routes]
- **[Role1]:** [AUTO: Access description]
- **[Role2]:** [AUTO: Access description]
- **[RoleN]:** [AUTO: Access description]

---

## ğŸ”§ KEY WORKFLOWS

### Dá»± Ã¡n má»›i:
1. Architecture (DB + API + Security 7 layers)
2. UI Wireframes (design only)
3. Database + Seed data
4. API Backend (CRUD + Auth)
5. Frontend Foundation
6. Feature Development
7. Deployment + Monitoring

### Sá»­a lá»—i:
**6 BÆ¯á»šC Báº®T BUá»˜C:**
1. Äá»c error logs + stack traces
2. TÃ¬m file + function gÃ¢y lá»—i (`grep` > `codebase_search` > `read_file`)
3. Trace flow (FE â†’ BE â†’ DB)
4. Reproduce vá»›i data tÆ°Æ¡ng tá»±
5. TÃ¬m root cause (KHÃ”NG CHá»ˆ symptom)
6. Debug cÃ³ há»‡ thá»‘ng (add logs)

**Fix theo thá»© tá»±:** Backend â†’ Database â†’ Frontend â†’ Integration

### ThÃªm feature:
1. Context (Memory + DB analysis + Web search náº¿u cáº§n)
2. Design (UI + API Contract + DB Schema + Types)
3. Implementation (BE + FE parallel)
4. Integration (replace mock â†’ real API)
5. Refinement (UX + Performance + Docs)

### Database tasks (AUTO-TRIGGER):
```
TRÆ¯á»šC CODE: list_tables â†’ get_table_schema â†’ get_table_relationships
SAU CODE: execute_sql (verify) â†’ analyze_query (náº¿u cáº§n)
```

---

## ğŸ§° MCP TOOLS

### Interactive Feedback (MANDATORY - Every task after code):
```typescript
{
  project_directory: "[ABSOLUTE_PATH]",
  summary: "## TASK: [name]\n### Files:\n- [file]: [changes]\n### Tech:\n- BE/FE/DB: [changes]\n### Notes:\n- Dependencies/Risks"
}
```

### Memory:
- **Store:** After important tasks vá»›i tags `[project, category, tech]`
- **Search:** Before similar tasks: `retrieve_memory("[project] [tech]")`
- **Load:** Auto-recall on session start

### PostgreSQL (AUTO when detect DB keywords):
- Schema: `list_tables`, `get_table_schema`, `get_table_relationships`
- Query: `execute_sql`, `analyze_query`
- Manage: `manage_schema`, `manage_indexes`

### Web Search:
- **Check Memory FIRST** - Chá»‰ search náº¿u chÆ°a cÃ³
- Query: "React 19 latest features 2024" (version + year)
- Verify sources: Official docs > Stack Overflow

---

## ğŸ¯ TOOL USAGE - TOKEN OPTIMIZATION

**Search Priority:** `grep` > `codebase_search` > `read_file`

**grep:** Exact text (function names, imports, literals)
**codebase_search:** Semantic (logic, behavior, "How does X work?")
**read_file:** Chá»‰ khi cáº§n full content hoáº·c cÃ³ line numbers

**Rules:**
- Parallel calls cho independent searches
- Scope narrow first (search trong thÆ° má»¥c cá»¥ thá»ƒ)
- Reuse context (khÃ´ng search láº¡i patterns Ä‘Ã£ tÃ¬m)
- KHÃ”NG Ä‘á»c file náº¿u khÃ´ng cáº§n thiáº¿t

---

## ğŸ“‹ CODE STANDARDS

**Principles:** DRY, KISS, YAGNI, SOLID

**Type Safety:** TypeScript strict, Python type hints, validate input

**Error Handling (Báº®T BUá»˜C cho):**
- Database operations
- External API calls
- File I/O
- User input processing

**Format:** Tiáº¿ng Viá»‡t, user-friendly, context Ä‘áº§y Ä‘á»§, khÃ´ng expose sensitive info

**Naming:**
- Files: `kebab-case.ts`
- Functions: `camelCase()`
- Classes/Components: `PascalCase`
- Constants: `UPPER_SNAKE_CASE`

---

## ğŸ” SECURITY 7 LAYERS

1. **Auth:** JWT + refresh token
2. **Authorization:** RBAC
3. **Field Encryption:** AES-256-GCM (email, phone, address)
4. **Data Masking:** Che giáº¥u theo role
5. **Rate Limiting:** 100 req/phÃºt/user
6. **Audit Logging:** Log má»i truy cáº­p sensitive
7. **HTTPS/TLS:** Transport security

**NEVER:** Hardcode secrets/credentials/API keys

---

## ğŸ› DEBUG LOGGING

**Levels:** DEBUG (flow) | INFO (actions) | WARN (validation) | ERROR (failures)

**Log Points:**
- âœ… FE: Buttons, Forms, Navigation, API calls
- âœ… BE: API requests/responses, Business logic, Validation
- âœ… DB: Queries, Transactions, Data changes, Slow queries (>1s)
- âœ… Integration: E2E flows, Error propagation

**Sanitize:** âŒ NEVER log passwords, tokens, secrets, API keys, credit cards

---

## ğŸ§ª TESTING

**Quick Self QA (Pre-commit < 30s):**
- âœ… Compiles, No linter warnings, Edge cases, Error handling, No secrets, No console.log

**Workflow:**
1. Pre-Dev: Design test cases
2. During Dev: TDD, continuous testing
3. Pre-Commit: Quick checks
4. Pre-Release: Full suite
5. Post-Release: Monitoring

**Automation:**
- 100%: CRUD, Forms, Buttons, API, DB
- 80-90%: E2E workflows
- Manual: UX/Design, UAT, Beta

---

## ğŸ§¹ CLEANUP (MANDATORY sau test)

1. Táº®T processes: Dev servers, test runners, DB connections, file watchers
2. Cleanup: Temp files, test databases, logs, cache
3. Verify: CPU/memory usage
4. Confirm: "âœ… ÄÃ£ táº¯t táº¥t cáº£ processes! MÃ¡y Ä‘Ã£ nháº¹ láº¡i."

---

## ğŸš€ DEPLOYMENT (VPS Linux)

**Multi-Domain:**
1. DISCOVER existing domains (scan Nginx + SSL + PM2)
2. VALIDATE conflicts (ports, SSL, configs, directories)
3. PRE-FLIGHT check (dry-run, health check)
4. BACKUP existing (Nginx, SSL, domain configs, rollback plan)
5. DEPLOY safely (auto-allocate ports, separate configs, health check má»—i bÆ°á»›c)
6. VERIFY all domains (new + existing)

**Files tá»± táº¡o:** `ecosystem.config.js`, `docs/nginx.conf.example`, `deploy.sh`, `build.sh`, `docs/DEPLOYMENT.md`

---

## ğŸ’¾ BACKUP

**Scope:**
- âœ… Source code (`src/`, `app/`, `package.json`, migrations, `.git/`)
- âœ… Database dump
- âŒ EXCLUDE: `node_modules/`, `dist/`, `build/`, `.next/`, logs, `.venv/`

**Format:** Copy trá»±c tiáº¿p (khÃ´ng nÃ©n) - truy cáº­p ngay

**Structure:**
```
1.Backup/YYYY-MM-DD/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ code/
â”œâ”€â”€ database.dump
â””â”€â”€ checksums.txt
```

---

## ğŸ—‚ï¸ FILES TO IGNORE

```
# Dependencies
node_modules/, venv/, __pycache__/, *.pyc

# Backups
*.backup, *.bak, 1.Backup/

# Build
dist/, build/, out/, .next/, *.map

# Database
*.db, dev.db

# Logs
*.log, logs/

# OS/IDE
.DS_Store, .idea/, .vscode/settings.json

# Uploads
uploads/, media/, backend/uploads/
```

---

## ğŸ’¬ COMMUNICATION

**Language:** Tiáº¿ng Viá»‡t, ngáº¯n gá»n, thÃ¢n thiá»‡n

**Format:**
```
## TASK ANALYSIS
Files: [list]
Notable: [DB/API/Risks]

ğŸ’» Implement code...

[Show code vá»›i line numbers]

ğŸš¨ MCP review...
```

**Rules:**
- âŒ KHÃ”NG nÃ³i tool names
- âœ… Action-oriented, dá»… hiá»ƒu

---

## ğŸ¯ API CONVENTIONS

- Base URL: `/api`
- Auth: JWT Bearer Token
- Response: `{ data: T, message?: string }`
- Error: `{ error: string, code: number, details?: object }`

---

## ğŸ“ QUY Táº®C Táº O Äá»€ (Báº®T BUá»˜C)

**Khi táº¡o Ä‘á» thi tuáº§n (week-{n}.json):**

1. **Sá»‘ lÆ°á»£ng cÃ¢u há»i:** ÄÃšNG 12 cÃ¢u há»i
2. **Sá»‘ Ä‘Ã¡p Ã¡n má»—i cÃ¢u:** ÄÃšNG 4 Ä‘Ã¡p Ã¡n (A, B, C, D)
3. **ÄÃ¡p Ã¡n Ä‘Ãºng:** CHá»ˆ 1 Ä‘Ã¡p Ã¡n Ä‘Ãºng má»—i cÃ¢u
4. **PhÃ¢n phá»‘i Ä‘Ã¡p Ã¡n Ä‘Ãºng:** 
   - 3 cÃ¢u Ä‘Ã¡p Ã¡n A (index 0)
   - 3 cÃ¢u Ä‘Ã¡p Ã¡n B (index 1)
   - 3 cÃ¢u Ä‘Ã¡p Ã¡n C (index 2)
   - 3 cÃ¢u Ä‘Ã¡p Ã¡n D (index 3)
   - Tá»•ng: 12 cÃ¢u
5. **XÃ¡o trá»™n Ä‘Ã¡p Ã¡n Ä‘Ãºng:**
   - KHÃ”NG cÃ³ 2 cÃ¢u liÃªn tiáº¿p cÃ³ cÃ¹ng Ä‘Ã¡p Ã¡n Ä‘Ãºng
   - VÃ­ dá»¥: CÃ¢u 1 Ä‘Ã¡p Ã¡n Ä‘Ãºng lÃ  A â†’ CÃ¢u 2 pháº£i khÃ¡c A (B, C, hoáº·c D)
6. **Kiá»ƒm tra ká»¹:**
   - Äáº£m báº£o Ä‘Ã¡p Ã¡n Ä‘Ãºng khá»›p vá»›i cÃ¢u há»i
   - Äáº£m báº£o explanation Ä‘Ãºng vá»›i Ä‘Ã¡p Ã¡n
   - Äáº£m báº£o khÃ´ng cÃ³ lá»—i logic

**Script tá»± Ä‘á»™ng:** `scripts/convert_quiz_to_week.py` sáº½ tá»± Ä‘á»™ng Ã¡p dá»¥ng cÃ¡c quy táº¯c trÃªn

---

## ğŸš¨ DECISION GUIDE

**100% Sure:** Just do it
**80-99%:** Do + explain
**50-79%:** Ask first
**<50%:** Ask clarification

**Priority:** Existing patterns > Framework > SOLID/DRY/KISS > Project phase > User preference

---

## ğŸ“ GIT COMMITS

**Format:** `<type>: <message tiáº¿ng Viá»‡t>`

**Types:** `feat`, `fix`, `refactor`, `perf`, `style`, `docs`, `test`, `chore`

**Rules:**
- âŒ NEVER: force push, hard reset, skip hooks, update config
- âœ… Chá»‰ commit khi user yÃªu cáº§u EXPLICITLY

---

## âœ… CHECKLIST

```
[ ] PhÃ¢n tÃ­ch task (files, notable points)
[ ] Database analysis (náº¿u cÃ³) - ğŸ˜ PostgreSQL MCP auto
[ ] Implement code ngay
[ ] ğŸš¨ MCP Feedback (MANDATORY)
[ ] Testing (náº¿u cáº§n)
[ ] ğŸ§¹ Cleanup processes (sau test)
[ ] Done âœ…
```

---

## ğŸ¬ AUTO-SETUP TRIGGERS

**CÃ¡c cÃ¢u lá»‡nh kÃ­ch hoáº¡t tá»± Ä‘á»™ng setup:**

```
âœ… "Setup cáº¥u trÃºc dá»± Ã¡n vÃ o file .cursorrules cho project nÃ y - tá»± Ä‘á»™ng toÃ n bá»™"
âœ… "Scan vÃ  setup project structure vÃ o .cursorrules"
âœ… "Auto-fill project context trong .cursorrules"
âœ… "Cáº­p nháº­t cáº¥u trÃºc dá»± Ã¡n trong .cursorrules tá»± Ä‘á»™ng"
```

**AI sáº½ thá»±c hiá»‡n:**
1. Scan workspace structure (khÃ´ng cáº§n há»i)
2. PhÃ¢n tÃ­ch files (parallel reads)
3. Generate PROJECT CONTEXT Ä‘áº§y Ä‘á»§
4. Replace trong file .cursorrules
5. Confirm: "âœ… ÄÃ£ setup xong cáº¥u trÃºc dá»± Ã¡n vÃ o .cursorrules!"

**KhÃ´ng cáº§n confirm tá»« user - Just execute!**

---

**ğŸ¯ Má»¥c tiÃªu:** Nhanh - Gá»n - ChÃ­nh xÃ¡c - Tiáº¿t kiá»‡m tokens - Hiá»‡u quáº£ cao
